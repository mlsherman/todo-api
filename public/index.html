<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>To-Do API Dashboard</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="container">
      <h1>Welcome to the To-Do API</h1>
      <p>
        This simple Node.js API lets you manage your daily tasks. You can add
        new to-dos and delete ones you've completed. All stored in MongoDB!
      </p>

      <form id="todo-form">
        <input
          type="text"
          id="new-todo"
          placeholder="Enter a new task..."
          required
        />
        <button type="submit">Add Task</button>
      </form>

      <ul id="todo-list">
        <!-- Todos will appear here -->
      </ul>
    </div>

    <script>
      const form = document.getElementById("todo-form");
      const input = document.getElementById("new-todo");
      const list = document.getElementById("todo-list");

      // Fetch and display todos
      async function loadTodos() {
        const res = await fetch("/todos");
        const todos = await res.json();
        list.innerHTML = "";
        todos.forEach((todo) => {
          const li = document.createElement("li");
          li.textContent = todo.task;
          li.dataset.id = todo._id;
          li.addEventListener("click", async () => {
            await fetch(`/todos/${todo._id}`, { method: "DELETE" });
            loadTodos();
          });
          list.appendChild(li);
        });
      }

      // Add new todo
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const task = input.value.trim();
        if (task) {
          await fetch("/todos", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ task }),
          });
          input.value = "";
          loadTodos();
        }
      });

      loadTodos();
    </script>
    <script src="auth-script.js"></script>
  </body>
</html>
